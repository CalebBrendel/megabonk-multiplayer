<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props"
          Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />

  <!-- Project settings -->
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>

    <ProjectGuid>{F1C64F3E-7B8A-4B17-9D7B-9B6E1C3B9E21}</ProjectGuid>
    <OutputType>Library</OutputType>
    <RootNamespace>Megabonk.Multiplayer</RootNamespace>
    <AssemblyName>Megabonk.Multiplayer</AssemblyName>

    <!-- Match Steamworks.NET -->
    <TargetFrameworkVersion>v4.8</TargetFrameworkVersion>

    <!-- MelonLoader is AMD64 -->
    <PlatformTarget>x64</PlatformTarget>
    <Prefer32Bit>false</Prefer32Bit>

    <LangVersion>latest</LangVersion>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <Nullable>disable</Nullable>
  </PropertyGroup>

  <!-- Output folders -->
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <OutputPath>..\..\build\Debug\</OutputPath>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <OutputPath>..\..\build\Release\</OutputPath>
  </PropertyGroup>

  <!-- Source files -->
  <ItemGroup>
    <Compile Include="**\*.cs" Exclude="bin\**\*;obj\**\*" />
  </ItemGroup>

  <!-- Compute repo paths -->
  <PropertyGroup>
    <ThisProjDir>$(MSBuildThisFileDirectory)</ThisProjDir>
    <RepoRoot>$([System.IO.Path]::GetFullPath('$(ThisProjDir)..\..\'))</RepoRoot>
    <LibsDir>$(RepoRoot)libs\</LibsDir>

    <!-- Prefer net35 if present; else net6 -->
    <MelonNet35Dir>$(LibsDir)MelonLoader\net35\</MelonNet35Dir>
    <MelonNet6Dir>$(LibsDir)MelonLoader\net6\</MelonNet6Dir>
    <UseMelonNet35 Condition="Exists('$(MelonNet35Dir)MelonLoader.dll')">true</UseMelonNet35>
    <UseMelonNet6 Condition="'$(UseMelonNet35)' != 'true' And Exists('$(MelonNet6Dir)MelonLoader.dll')">true</UseMelonNet6>

    <SteamworksDir>$(LibsDir)Steamworks.NET\</SteamworksDir>
  </PropertyGroup>

  <!-- MelonLoader refs (net35) -->
  <ItemGroup Condition="'$(UseMelonNet35)' == 'true'">
    <Reference Include="MelonLoader">
      <HintPath>$(MelonNet35Dir)MelonLoader.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="0Harmony">
      <HintPath>$(MelonNet35Dir)0Harmony.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine">
      <HintPath>$(MelonNet35Dir)UnityEngine.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine.CoreModule">
      <HintPath>$(MelonNet35Dir)UnityEngine.CoreModule.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine.InputLegacyModule">
      <HintPath>$(MelonNet35Dir)UnityEngine.InputLegacyModule.dll</HintPath>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <!-- MelonLoader refs (net6) -->
  <ItemGroup Condition="'$(UseMelonNet6)' == 'true'">
    <Reference Include="MelonLoader">
      <HintPath>$(MelonNet6Dir)MelonLoader.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="0Harmony">
      <HintPath>$(MelonNet6Dir)0Harmony.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine">
      <HintPath>$(MelonNet6Dir)UnityEngine.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine.CoreModule">
      <HintPath>$(MelonNet6Dir)UnityEngine.CoreModule.dll</HintPath>
      <Private>false</Private>
    </Reference>
    <Reference Include="UnityEngine.InputLegacyModule">
      <HintPath>$(MelonNet6Dir)UnityEngine.InputLegacyModule.dll</HintPath>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <!-- Steamworks.NET from repo -->
  <ItemGroup>
    <Reference Include="Steamworks.NET">
      <HintPath>$(SteamworksDir)Steamworks.NET.dll</HintPath>
      <Private>false</Private>
    </Reference>

    <!-- .NET -->
    <Reference Include="System" />
    <Reference Include="System.Core" />
  </ItemGroup>

  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project>
